<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ê–†–ê –ö–ê–†–¢</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
        }

        body {
            background: #181818;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #fff;
            overflow: hidden;
        }

        /* Main container */
        .game-wrapper {
            height: 100vh;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            padding: 24px;
            position: relative;
            overflow: hidden;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            flex-shrink: 0;
            margin-bottom: 20px; /* min gap to timer */
        }

        /* Test button (temporary) */
        .test-btn {
            padding: 8px 12px;
            background: #CCED00;
            color: #000;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Logo */
        .logo {
            font-family: "Montserrat", sans-serif;
            font-size: 20px;
            font-weight: 300;
            line-height: 0.9;
            height: 36px;
            color: #3BA8EA;
        }

        /* Sound button */
        .sound-btn {
            width: 44px;
            height: 44px;
            border: 1px solid #fff;
            border-radius: 10px;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.2s;
        }

        .sound-btn svg {
            width: 20px;
            height: 20px;
            fill: #fff;
        }

        /* Timer wrapper */
        .timer-wrapper {
            margin-top: auto; /* push timer down, flexible gap from header */
            flex-shrink: 0;
        }

        /* Timer */
        .timer {
            font-family: "Montserrat", sans-serif;
            font-size: 50px;
            font-weight: 400;
            color: #fff;
            line-height: 50px;
        }

        .timer .ms {
            font-family: "Montserrat", sans-serif;
            font-size: 22px;
            font-weight: 400;
            line-height: 50px;
        }

        /* Game board container */
        .game-container {
            /* Ideal height for square cards, can shrink if needed */
            flex: 0 1 calc((100vw - 52px) * 4 / 3 + 6px);
            margin-top: 50px; /* fixed gap from timer */
            min-height: 0;
        }

        /* Game board - 3x4 grid */
        .game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 2px;
            width: 100%;
            height: 100%;
        }

        /* Card styles */
        .card {
            cursor: pointer;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.25s ease;
            min-height: 0;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card.matched {
            animation: matchPulse 0.25s ease;
        }

        @keyframes matchPulse {
            0%, 100% { transform: rotateY(180deg) scale(1); }
            50% { transform: rotateY(180deg) scale(1.02); }
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-back {
            background: #3BA8EA;
        }

        .card-front {
            background: #206CF3;
            transform: rotateY(180deg);
            font-size: 54px;
        }

        .card.matched .card-front {
            background: #CCED00;
        }

        .card:active:not(.flipped):not(.matched) {
            transform: scale(0.97);
        }

        /* Footer */
        .footer {
            display: none;
        }

        .footer a {
            color: rgba(255, 255, 255, 0.5);
            text-decoration: none;
            font-size: 12px;
        }

        /* Best time display */
        .best-time-display {
            display: block;
            margin-bottom: 2px;
        }

        .best-time-display .time {
            font-family: "Montserrat", sans-serif;
            font-size: 30px;
            font-weight: 300;
            line-height: 30px;
            color: #CCED00;
        }

        .best-time-display .time .ms {
            font-family: "Montserrat", sans-serif;
            font-size: 22px;
            font-weight: 300;
            line-height: 30px;
        }

        /* Win card */
        .win-card {
            display: none;
            width: 100%;
            height: 100%;
            background: #CCED00;
            border-radius: 12px;
            padding: 24px;
            flex-direction: column;
            justify-content: space-between;
            opacity: 0;
            transform: scale(0.95);
        }

        .win-card.visible {
            display: flex;
        }

        .win-card.show {
            opacity: 1;
            transform: scale(1);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .win-card-content {
            display: flex;
            flex-direction: column;
        }

        .win-emoji {
            font-size: 50px;
            line-height: 50px;
            margin-bottom: 20px;
        }

        .win-title {
            font-family: "Montserrat", sans-serif;
            font-size: 50px;
            font-weight: 400;
            line-height: 50px;
            color: #181818;
        }

        .play-again-btn {
            width: 100%;
            height: 56px;
            background: #fff;
            border: none;
            border-radius: 16px;
            font-family: "Montserrat", sans-serif;
            font-size: 20px;
            font-weight: 400;
            line-height: 100%;
            color: #181818;
            cursor: pointer;
            transition: opacity 0.2s;
            margin-top: auto;
        }

        .play-again-btn:hover {
            opacity: 0.8;
        }

        .play-again-btn:active {
            transform: scale(0.98);
        }

        /* Hide desktop sound button on mobile */
        .sound-btn-desktop {
            display: none;
        }

        /* ==================== */
        /* DESKTOP LAYOUT 601px+ */
        /* ==================== */
        @media (min-width: 601px) {
            body {
                overflow: auto;
            }

            .game-wrapper {
                height: auto;
                min-height: 100vh;
                padding: 30px 40px;
                overflow: visible;
            }

            /* Header - only logo */
            .header {
                position: absolute;
                top: 30px;
                left: 40px;
                width: auto;
                margin-bottom: 0;
            }

            .logo {
                font-size: 20px;
                height: 36px;
            }

            /* Hide sound button from header on desktop */
            .header .sound-btn {
                display: none;
            }

            /* Test button - center of screen in header */
            .test-btn {
                position: absolute;
                left: 50%;
                top: 30px;
                transform: translateX(-50%);
            }

            /* Timer wrapper - top right */
            .timer-wrapper {
                position: absolute;
                top: 30px;
                right: 40px;
                margin-top: 0;
                display: flex;
                flex-direction: column;
                align-items: flex-end;
            }

            /* Sound button - bottom left */
            .sound-btn-desktop {
                display: flex;
                position: absolute;
                bottom: 30px;
                left: 40px;
                width: 36px;
                height: 36px;
                border: 1px solid #fff;
                border-radius: 8px;
                background: transparent;
                cursor: pointer;
                align-items: center;
                justify-content: center;
            }

            .sound-btn-desktop svg {
                width: 16px;
                height: 16px;
            }

            /* Footer - hidden on desktop */
            .footer {
                display: none;
            }

            /* Game container - centered */
            .game-container {
                flex: 1;
                margin-top: 0;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .game-board {
                max-width: 320px;
                height: auto;
                grid-template-rows: none;
                gap: 2px;
            }

            .card {
                aspect-ratio: 1;
            }

            .card-face {
                border-radius: 14px;
            }

            .card-front {
                font-size: 54px;
            }

            /* Win card - same size as game board */
            .win-card {
                max-width: 320px;
                width: 100%;
                height: auto;
                aspect-ratio: 3 / 4;
            }
        }

        /* ==================== */
        /* LARGE DESKTOP 1440px+ */
        /* ==================== */
        @media (min-width: 1440px) {
            .game-wrapper {
                padding: 30px 50px;
            }

            .header {
                top: 30px;
                left: 50px;
            }

            .timer-wrapper {
                right: 50px;
            }

            .sound-btn-desktop {
                left: 50px;
            }

            .game-board {
                max-width: 360px;
                gap: 2px;
            }

            .win-card {
                max-width: 360px;
            }
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <!-- Header -->
        <div class="header">
            <div class="logo">–ü–ê–†–ê<br>–ö–ê–†–¢</div>
            <button class="test-btn" id="testBtn" onclick="endGame()" style="display: none;">TEST</button>
            <button class="sound-btn" id="soundBtn" aria-label="Toggle sound">
                <svg viewBox="0 0 16 14" xmlns="http://www.w3.org/2000/svg">
                    <path class="sound-icon-on" d="M3.73333 10.1937L4.00747 9.73609L3.88053 9.66143H3.73333V10.1948V10.1937ZM3.73333 3.79796V4.3313H3.88053L4.00853 4.25556L3.73333 3.79796ZM9.06667 0.600096H9.6C9.60002 0.505732 9.575 0.413053 9.5275 0.331516C9.48 0.24998 9.41172 0.182506 9.32962 0.135981C9.24753 0.0894555 9.15456 0.0655451 9.0602 0.0666896C8.96584 0.0678342 8.87348 0.0939927 8.79253 0.142496L9.06667 0.600096ZM9.06667 13.3916L8.79253 13.8492C8.87348 13.8977 8.96584 13.9238 9.0602 13.925C9.15456 13.9261 9.24753 13.9022 9.32962 13.8557C9.41172 13.8092 9.48 13.7417 9.5275 13.6601C9.575 13.5786 9.60002 13.4859 9.6 13.3916H9.06667ZM14.7765 3.42036L14.4 3.04383L13.6459 3.79796L14.0235 4.17556L14.7765 3.42036ZM14.0235 9.8161L13.6459 10.1937L14.4 10.9478L14.7765 10.5713L14.0235 9.8161ZM3.73333 9.66036H1.6V10.727H3.73333V9.66036ZM1.6 9.66036C1.45855 9.66036 1.3229 9.60417 1.22288 9.50415C1.12286 9.40413 1.06667 9.26848 1.06667 9.12703H0C0 10.0124 0.7168 10.727 1.6 10.727V9.66036ZM1.06667 9.12703V4.86463H0V9.12916H1.06667V9.12703ZM1.06667 4.86356C1.06695 4.7223 1.12326 4.58692 1.22325 4.48713C1.32324 4.38734 1.45874 4.3313 1.6 4.3313V3.26463C1.17565 3.26463 0.768687 3.4332 0.468629 3.73326C0.168571 4.03332 0 4.44028 0 4.86463H1.06667V4.86356ZM1.6 4.3313H3.73333V3.26463H1.6V4.3313ZM4.00747 4.25556L9.3408 1.0577L8.79253 0.142496L3.4592 3.34036L4.00747 4.25556ZM8.53333 0.600096V13.3916H9.6V0.600096H8.53333ZM9.3408 12.934L4.00747 9.73609L3.4592 10.6513L8.79253 13.8492L9.3408 12.934ZM14.4 3.79796C14.0235 4.17556 14.0224 4.17556 14.0224 4.1745C14.0216 4.17389 14.0209 4.17317 14.0203 4.17236L14.0235 4.17556L14.0448 4.19903C14.2054 4.39527 14.3435 4.60887 14.4565 4.83583C14.6912 5.3041 14.9333 6.02196 14.9333 6.99583H16C16 5.83743 15.7099 4.95743 15.4101 4.35903C15.292 4.11989 15.1528 3.89179 14.9941 3.67743C14.9335 3.59722 14.8691 3.51997 14.8011 3.44596L14.7861 3.42996L14.7808 3.42463L14.7787 3.4225L14.7776 3.42143L14.4 3.79796ZM14.9333 6.99583C14.9333 7.9697 14.6901 8.68756 14.4565 9.15583C14.3435 9.3828 14.2054 9.5964 14.0448 9.79263C14.0378 9.80058 14.0307 9.8084 14.0235 9.8161L14.0203 9.81929L14.0213 9.81823L14.0224 9.81716L14.4 10.1937C14.7765 10.5713 14.7776 10.5713 14.7776 10.5702H14.7787L14.7808 10.567L14.7861 10.5617L14.8011 10.5468L14.8469 10.4956C14.8843 10.4529 14.9344 10.3921 14.9931 10.3142C15.1104 10.1585 15.2608 9.93023 15.4101 9.63263C15.7088 9.0353 16 8.15423 16 6.99583H14.9333Z" fill="white"/>
                    <path class="sound-icon-off" style="display: none;" d="M3.73333 10.1937L4.00747 9.73609L3.88053 9.66143H3.73333V10.1948V10.1937ZM3.73333 3.79796V4.3313H3.88053L4.00853 4.25556L3.73333 3.79796ZM9.06667 0.600096H9.6C9.60002 0.505732 9.575 0.413053 9.5275 0.331516C9.48 0.24998 9.41172 0.182506 9.32962 0.135981C9.24753 0.0894555 9.15456 0.0655451 9.0602 0.0666896C8.96584 0.0678342 8.87348 0.0939927 8.79253 0.142496L9.06667 0.600096ZM9.06667 13.3916L8.79253 13.8492C8.87348 13.8977 8.96584 13.9238 9.0602 13.925C9.15456 13.9261 9.24753 13.9022 9.32962 13.8557C9.41172 13.8092 9.48 13.7417 9.5275 13.6601C9.575 13.5786 9.60002 13.4859 9.6 13.3916H9.06667ZM12.2027 5.11103L11.8251 4.7345L11.0709 5.48863L11.4485 5.86623L12.2016 5.11103H12.2027ZM14.464 8.88063L14.8416 9.25716L15.5957 8.50303L15.2181 8.12649L14.464 8.88063ZM15.2192 5.86623L15.5957 5.48863L14.8416 4.7345L14.4651 5.11103L15.2192 5.86623ZM11.4485 8.12649L11.0709 8.50303L11.8251 9.25716L12.2027 8.88063L11.4485 8.12649ZM3.73333 9.66036H1.6V10.727H3.73333V9.66036ZM1.6 9.66036C1.52992 9.6605 1.46051 9.6468 1.39574 9.62005C1.33097 9.5933 1.27212 9.55402 1.22256 9.50447C1.17301 9.45491 1.13373 9.39606 1.10698 9.33129C1.08023 9.26652 1.06653 9.19711 1.06667 9.12703H0C0 10.0124 0.715733 10.727 1.6 10.727V9.66036ZM1.06667 9.12703V4.86463H0V9.12916H1.06667V9.12703ZM1.06667 4.86356C1.06667 4.56916 1.30453 4.3313 1.6 4.3313V3.26463C0.715733 3.26463 0 3.9793 0 4.86463H1.06667V4.86356ZM1.6 4.3313H3.73333V3.26463H1.6V4.3313ZM4.00747 4.25556L9.3408 1.0577L8.79253 0.142496L3.4592 3.34036L4.00747 4.25556ZM8.53333 0.600096V13.3916H9.6V0.600096H8.53333ZM9.3408 12.934L4.00747 9.73609L3.4592 10.6513L8.79253 13.8492L9.3408 12.934ZM11.4485 5.86623L14.464 8.88063L15.2181 8.12649L12.2016 5.11103L11.4475 5.86623H11.4485ZM14.4651 5.11103L11.4485 8.12649L12.2027 8.88063L15.2192 5.86623L14.4651 5.11103Z" fill="white"/>
                </svg>
            </button>
        </div>

        <!-- Timer wrapper for desktop positioning -->
        <div class="timer-wrapper">
            <!-- Best time -->
            <div class="best-time-display" id="bestTimeDisplay">
                <span class="time" id="bestTime">00:00<span class="ms">.00</span></span>
            </div>

            <!-- Timer -->
            <div class="timer" id="timer">00:00<span class="ms">.00</span></div>
        </div>

        <!-- Game board -->
        <div class="game-container">
            <div class="game-board" id="gameBoard"></div>
            
            <!-- Win card -->
            <div class="win-card" id="winCard">
                <div class="win-card-content">
                    <div class="win-emoji">üî•</div>
                    <div class="win-title">–î–∞ —É —Ç–µ–±—è —Ç–∞–ª–∞–Ω—Ç!</div>
                </div>
                <button class="play-again-btn" id="playAgainBtn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
            </div>
        </div>

        <!-- Footer (desktop only) -->
        <div class="footer">
            <a href="#">Memory Match Game</a>
        </div>

        <!-- Sound button desktop position -->
        <button class="sound-btn-desktop" id="soundBtnDesktop" aria-label="Toggle sound">
            <svg viewBox="0 0 16 14" xmlns="http://www.w3.org/2000/svg">
                <path class="sound-icon-on" d="M3.73333 10.1937L4.00747 9.73609L3.88053 9.66143H3.73333V10.1948V10.1937ZM3.73333 3.79796V4.3313H3.88053L4.00853 4.25556L3.73333 3.79796ZM9.06667 0.600096H9.6C9.60002 0.505732 9.575 0.413053 9.5275 0.331516C9.48 0.24998 9.41172 0.182506 9.32962 0.135981C9.24753 0.0894555 9.15456 0.0655451 9.0602 0.0666896C8.96584 0.0678342 8.87348 0.0939927 8.79253 0.142496L9.06667 0.600096ZM9.06667 13.3916L8.79253 13.8492C8.87348 13.8977 8.96584 13.9238 9.0602 13.925C9.15456 13.9261 9.24753 13.9022 9.32962 13.8557C9.41172 13.8092 9.48 13.7417 9.5275 13.6601C9.575 13.5786 9.60002 13.4859 9.6 13.3916H9.06667ZM14.7765 3.42036L14.4 3.04383L13.6459 3.79796L14.0235 4.17556L14.7765 3.42036ZM14.0235 9.8161L13.6459 10.1937L14.4 10.9478L14.7765 10.5713L14.0235 9.8161ZM3.73333 9.66036H1.6V10.727H3.73333V9.66036ZM1.6 9.66036C1.45855 9.66036 1.3229 9.60417 1.22288 9.50415C1.12286 9.40413 1.06667 9.26848 1.06667 9.12703H0C0 10.0124 0.7168 10.727 1.6 10.727V9.66036ZM1.06667 9.12703V4.86463H0V9.12916H1.06667V9.12703ZM1.06667 4.86356C1.06695 4.7223 1.12326 4.58692 1.22325 4.48713C1.32324 4.38734 1.45874 4.3313 1.6 4.3313V3.26463C1.17565 3.26463 0.768687 3.4332 0.468629 3.73326C0.168571 4.03332 0 4.44028 0 4.86463H1.06667V4.86356ZM1.6 4.3313H3.73333V3.26463H1.6V4.3313ZM4.00747 4.25556L9.3408 1.0577L8.79253 0.142496L3.4592 3.34036L4.00747 4.25556ZM8.53333 0.600096V13.3916H9.6V0.600096H8.53333ZM9.3408 12.934L4.00747 9.73609L3.4592 10.6513L8.79253 13.8492L9.3408 12.934ZM14.4 3.79796C14.0235 4.17556 14.0224 4.17556 14.0224 4.1745C14.0216 4.17389 14.0209 4.17317 14.0203 4.17236L14.0235 4.17556L14.0448 4.19903C14.2054 4.39527 14.3435 4.60887 14.4565 4.83583C14.6912 5.3041 14.9333 6.02196 14.9333 6.99583H16C16 5.83743 15.7099 4.95743 15.4101 4.35903C15.292 4.11989 15.1528 3.89179 14.9941 3.67743C14.9335 3.59722 14.8691 3.51997 14.8011 3.44596L14.7861 3.42996L14.7808 3.42463L14.7787 3.4225L14.7776 3.42143L14.4 3.79796ZM14.9333 6.99583C14.9333 7.9697 14.6901 8.68756 14.4565 9.15583C14.3435 9.3828 14.2054 9.5964 14.0448 9.79263C14.0378 9.80058 14.0307 9.8084 14.0235 9.8161L14.0203 9.81929L14.0213 9.81823L14.0224 9.81716L14.4 10.1937C14.7765 10.5713 14.7776 10.5713 14.7776 10.5702H14.7787L14.7808 10.567L14.7861 10.5617L14.8011 10.5468L14.8469 10.4956C14.8843 10.4529 14.9344 10.3921 14.9931 10.3142C15.1104 10.1585 15.2608 9.93023 15.4101 9.63263C15.7088 9.0353 16 8.15423 16 6.99583H14.9333Z" fill="white"/>
                <path class="sound-icon-off" style="display: none;" d="M3.73333 10.1937L4.00747 9.73609L3.88053 9.66143H3.73333V10.1948V10.1937ZM3.73333 3.79796V4.3313H3.88053L4.00853 4.25556L3.73333 3.79796ZM9.06667 0.600096H9.6C9.60002 0.505732 9.575 0.413053 9.5275 0.331516C9.48 0.24998 9.41172 0.182506 9.32962 0.135981C9.24753 0.0894555 9.15456 0.0655451 9.0602 0.0666896C8.96584 0.0678342 8.87348 0.0939927 8.79253 0.142496L9.06667 0.600096ZM9.06667 13.3916L8.79253 13.8492C8.87348 13.8977 8.96584 13.9238 9.0602 13.925C9.15456 13.9261 9.24753 13.9022 9.32962 13.8557C9.41172 13.8092 9.48 13.7417 9.5275 13.6601C9.575 13.5786 9.60002 13.4859 9.6 13.3916H9.06667ZM12.2027 5.11103L11.8251 4.7345L11.0709 5.48863L11.4485 5.86623L12.2016 5.11103H12.2027ZM14.464 8.88063L14.8416 9.25716L15.5957 8.50303L15.2181 8.12649L14.464 8.88063ZM15.2192 5.86623L15.5957 5.48863L14.8416 4.7345L14.4651 5.11103L15.2192 5.86623ZM11.4485 8.12649L11.0709 8.50303L11.8251 9.25716L12.2027 8.88063L11.4485 8.12649ZM3.73333 9.66036H1.6V10.727H3.73333V9.66036ZM1.6 9.66036C1.52992 9.6605 1.46051 9.6468 1.39574 9.62005C1.33097 9.5933 1.27212 9.55402 1.22256 9.50447C1.17301 9.45491 1.13373 9.39606 1.10698 9.33129C1.08023 9.26652 1.06653 9.19711 1.06667 9.12703H0C0 10.0124 0.715733 10.727 1.6 10.727V9.66036ZM1.06667 9.12703V4.86463H0V9.12916H1.06667V9.12703ZM1.06667 4.86356C1.06667 4.56916 1.30453 4.3313 1.6 4.3313V3.26463C0.715733 3.26463 0 3.9793 0 4.86463H1.06667V4.86356ZM1.6 4.3313H3.73333V3.26463H1.6V4.3313ZM4.00747 4.25556L9.3408 1.0577L8.79253 0.142496L3.4592 3.34036L4.00747 4.25556ZM8.53333 0.600096V13.3916H9.6V0.600096H8.53333ZM9.3408 12.934L4.00747 9.73609L3.4592 10.6513L8.79253 13.8492L9.3408 12.934ZM11.4485 5.86623L14.464 8.88063L15.2181 8.12649L12.2016 5.11103L11.4475 5.86623H11.4485ZM14.4651 5.11103L11.4485 8.12649L12.2027 8.88063L15.2192 5.86623L14.4651 5.11103Z" fill="white"/>
            </svg>
        </button>
    </div>

    <script>
        // Game configuration - 6 pairs for 3x4 grid
        const EMOJIS = ['üëπ', 'ü§°', 'üëΩ', 'üéÉ', 'ü§ñ', 'üê∏'];
        
        // Win phrases - shown randomly on victory
        const WIN_PHRASES = [
            '–î–∞ —É —Ç–µ–±—è —Ç–∞–ª–∞–Ω—Ç!',
            '–í—Å–µ –ø–∞—Ä—ã –Ω–∞–π–¥–µ–Ω—ã!',
            '–í–∞—É!',
            '–¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å!',
            '–í–æ—Ç —ç—Ç–æ —Å–∫–æ—Ä–æ—Å—Ç—å!',
            '–°–ø–∏—à—å?'
        ];
        
        // Sound system ‚Äî Web Audio API for reliable low-latency mobile playback
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        let audioContext = null;
        const audioBuffers = {};
        let soundEnabled = true;

        // Preload and decode all sound files into memory
        async function initAudioSystem() {
            try {
                audioContext = new AudioCtx();
                const soundFiles = { flip: 'flip.mp3', match: 'matched.mp3', win: 'win.mp3' };
                await Promise.all(
                    Object.entries(soundFiles).map(async ([name, url]) => {
                        try {
                            const resp = await fetch(url);
                            const buf = await resp.arrayBuffer();
                            audioBuffers[name] = await audioContext.decodeAudioData(buf);
                        } catch (_) { /* sound load failed, continue silently */ }
                    })
                );
            } catch (_) { /* Web Audio API not supported */ }
        }

        // Unlock AudioContext on first user gesture (required by mobile browsers)
        function unlockAudio() {
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }
        document.addEventListener('touchstart', unlockAudio, { once: true });
        document.addEventListener('touchend', unlockAudio, { once: true });
        document.addEventListener('click', unlockAudio, { once: true });

        // Play sound ‚Äî creates a fresh source node each time (instant, no conflicts)
        function playSound(soundName) {
            if (!soundEnabled || !audioContext || !audioBuffers[soundName]) return;
            if (audioContext.state === 'suspended') audioContext.resume();
            const source = audioContext.createBufferSource();
            source.buffer = audioBuffers[soundName];
            source.connect(audioContext.destination);
            source.start(0);
        }

        // Start loading audio immediately
        initAudioSystem();
        
        // Game state
        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let isLocked = false;
        let timerInterval = null;
        let startTime = null;
        let elapsedTime = 0;
        let gameStarted = false;
        let bestTime = localStorage.getItem('duoQuestBestTime') ? parseInt(localStorage.getItem('duoQuestBestTime')) : null;

        // DOM elements
        const gameBoard = document.getElementById('gameBoard');
        const timerDisplay = document.getElementById('timer');
        const winCard = document.getElementById('winCard');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const bestTimeDisplay = document.getElementById('bestTimeDisplay');
        const bestTimeElement = document.getElementById('bestTime');

        // Initialize game
        function initGame() {
            cards = [];
            flippedCards = [];
            matchedPairs = 0;
            isLocked = false;
            gameStarted = false;
            elapsedTime = 0;
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            timerDisplay.innerHTML = '00:00<span class="ms">.00</span>';
            
            // Show best time (or 00:00.00 if none)
            if (bestTime) {
                bestTimeElement.innerHTML = formatTime(bestTime);
            } else {
                bestTimeElement.innerHTML = '00:00<span class="ms">.00</span>';
            }
            
            // Create card pairs (6 pairs = 12 cards for 3x4 grid)
            const cardPairs = [...EMOJIS, ...EMOJIS];
            
            // Shuffle cards
            for (let i = cardPairs.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cardPairs[i], cardPairs[j]] = [cardPairs[j], cardPairs[i]];
            }
            
            gameBoard.innerHTML = '';
            
            cardPairs.forEach((emoji, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.index = index;
                card.dataset.emoji = emoji;
                
                card.innerHTML = `
                    <div class="card-face card-back"></div>
                    <div class="card-face card-front">${emoji}</div>
                `;
                
                card.addEventListener('click', () => flipCard(card));
                gameBoard.appendChild(card);
                cards.push(card);
            });
            
            // Hide win card, show game board
            winCard.classList.remove('show');
            winCard.classList.remove('visible');
            gameBoard.style.display = 'grid';
        }

        // Flip card
        function flipCard(card) {
            if (isLocked || 
                card.classList.contains('flipped') || 
                card.classList.contains('matched') ||
                flippedCards.length >= 2) {
                return;
            }
            
            if (!gameStarted) {
                gameStarted = true;
                startTime = Date.now();
                timerInterval = setInterval(updateTimer, 10);
            }
            
            card.classList.add('flipped');
            flippedCards.push(card);
            playSound('flip');
            
            if (flippedCards.length === 2) {
                checkMatch();
            }
        }

        // Check match
        function checkMatch() {
            isLocked = true;
            const [card1, card2] = flippedCards;
            
            if (card1.dataset.emoji === card2.dataset.emoji) {
                setTimeout(() => {
                    card1.classList.add('matched');
                    card2.classList.add('matched');
                    playSound('match');
                    matchedPairs++;
                    flippedCards = [];
                    isLocked = false;
                    
                    if (matchedPairs === EMOJIS.length) {
                        endGame();
                    }
                }, 150);
            } else {
                setTimeout(() => {
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                    flippedCards = [];
                    isLocked = false;
                }, 600);
            }
        }

        // Update timer
        function updateTimer() {
            elapsedTime = Date.now() - startTime;
            timerDisplay.innerHTML = formatTime(elapsedTime);
        }

        // Format time
        function formatTime(ms) {
            const minutes = Math.floor(ms / 60000);
            const seconds = Math.floor((ms % 60000) / 1000);
            const milliseconds = Math.floor((ms % 1000) / 10);
            
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}<span class="ms">.${milliseconds.toString().padStart(2, '0')}</span>`;
        }

        // End game
        function endGame() {
            clearInterval(timerInterval);
            playSound('win');
            
            // Show random win phrase
            const randomPhrase = WIN_PHRASES[Math.floor(Math.random() * WIN_PHRASES.length)];
            document.querySelector('.win-title').textContent = randomPhrase;
            
            // Update best time if needed
            if (!bestTime || elapsedTime < bestTime) {
                bestTime = elapsedTime;
                localStorage.setItem('duoQuestBestTime', bestTime);
                bestTimeElement.innerHTML = formatTime(bestTime);
            }
            
            // Hide game board, show win card with animation
            setTimeout(() => {
                gameBoard.style.display = 'none';
                winCard.classList.add('visible');
                // Trigger animation after display is set
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        winCard.classList.add('show');
                    });
                });
            }, 300);
        }

        // Event listeners
        playAgainBtn.addEventListener('click', initGame);
        
        // Sound toggle
        const soundBtn = document.getElementById('soundBtn');
        const soundBtnDesktop = document.getElementById('soundBtnDesktop');
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            // Toggle icons
            document.querySelectorAll('.sound-icon-on').forEach(el => {
                el.style.display = soundEnabled ? 'block' : 'none';
            });
            document.querySelectorAll('.sound-icon-off').forEach(el => {
                el.style.display = soundEnabled ? 'none' : 'block';
            });
        }
        
        soundBtn.addEventListener('click', toggleSound);
        soundBtnDesktop.addEventListener('click', toggleSound);

        // Start
        initGame();
    </script>
</body>
</html>
